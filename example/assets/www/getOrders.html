<!DOCTYPE html>
<html>
<head>
    <title>Deliver IT - Order Notification</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/themes/1/conf-room1.min.css" rel="stylesheet" />
    <link href="css/themes/1/jquery.mobile.icons.min.css" rel="stylesheet" />
	<style type="text/css">
html { height: 100% }
body { height: 100%; margin: 0px; padding: 0px }
</style>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="css/jquery.mobile.squareui.css" />
  <script src="js/jquery.js"></script>

<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.exp&key=AIzaSyBtTcw1C9SfDbgy2aKfOt_5N8m2Ltpqdu8&sensor=false"></script>
  <script type="text/javascript">
  var directionDisplay;
  var directionsService = new google.maps.DirectionsService();
  var map;

  function initialize() {
    directionsDisplay = new google.maps.DirectionsRenderer();
    var chicago = new google.maps.LatLng(41.850033, -87.6500523);
    var myOptions = {
      zoom: 6,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      center: chicago
    }
    map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
    directionsDisplay.setMap(map);
    calcRoute();
  }
  
  function calcRoute() {

    var request = {
        // from: Blackpool to: Preston to: Blackburn
        origin: "214 North Craig Street Pittsburgh", 
        destination: "5000 Forbes Avenue Pittsburgh", 
        waypoints: [{
          location: "664 Summerlea St, Pittsburgh, PA 15232",
          stopover:true}],
        optimizeWaypoints: true,
        travelMode: google.maps.DirectionsTravelMode.DRIVING
    };
    directionsService.route(request, function(response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
        var route = response.routes[0];
        var summaryPanel = document.getElementById("directions_panel");
        summaryPanel.innerHTML = "";
        // For each route, display summary information.
        for (var i = 0; i < route.legs.length; i++) {
          var routeSegment = i + 1;
		  if ( i == 0) {
          summaryPanel.innerHTML += "<p>"+ "<b>Resturant: " + "restaurant_name here" +  "</b> </p>";
		  }
		  else {
			  summaryPanel.innerHTML += "<p>"+ "<b>Order: " + "#837489" +  "</b> </p>";
		  }
          summaryPanel.innerHTML += "<p>Location: " + route.legs[i].end_address + "</p>";
          summaryPanel.innerHTML += "<p>Distance: " + route.legs[i].distance.text + "</p><br /><br />";
        }
        computeTotalDistance(response);
      } else {
        alert("directions response "+status);
      }
    });
  }

      function computeTotalDistance(result) {
      var totalDist = 0;
      var totalTime = 0;
      var myroute = result.routes[0];
      for (i = 0; i < myroute.legs.length; i++) {
        totalDist += myroute.legs[i].distance.value;
        totalTime += myroute.legs[i].duration.value;      
      }
      totalDist = totalDist / 1000.
      document.getElementById("total").innerHTML = "total distance is: "+ totalDist + " km<br>total time is: " + (totalTime / 60).toFixed(2) + " minutes";
      }
</script>

</head>

<body onload="initialize()">
<div data-url="map-page" data-role="page" id="map-page">
    <div data-role="header" data-theme="a">
    <h1>Delivery</h1>
    </div>
	
    <div role="main" class="ui-content" id="map-canvas" style="width:70%;height:200%;padding:10em">
        <!-- map loads here... -->
    </div>
	
	<ul data-role="listview" data-editable="true" data-editable-type="complex" data-editable-form="editing-form" data-title="Orders" data-empty-title="No Orders">
  <li>
    <a id="directions_panel" >
      <h3>Order #2356:</h3>
      <p><em>Restaurant:</em> <strong>Heinz Cafe</strong></p>
      <p><em>Location:</em> <strong>North Craig Street</strong></p>
	  <p><em>Pickup:</em> <strong>ETA 10mins</strong></p>

    </a>
  </li>
    <li id = "total">
  </li>
</ul>

</div>
</div>
</body>
</html>
